<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stats Dashboard | Educational purpose only</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial;
}

/* ===== TOP BAR ===== */
.topbar{
  display:flex;
  align-items:center;
  background:#000;
  padding:10px;
}
.back-btn{
  color:#00bcd4;
  font-size:14px;
  cursor:pointer;
  margin-right:10px;
}
h2{
  flex:1;
  text-align:center;
  margin:0;
  font-size:16px;
}

/* ===== CARDS ===== */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  padding:12px;
}
.card{
  background:#111;
  border-radius:10px;
  padding:14px;
  box-shadow:0 6px 18px rgba(0,0,0,0.6);
}
.label{
  font-size:12px;
  color:#aaa;
}
.value{
  font-size:20px;
  font-weight:bold;
  margin-top:4px;
}
.green{ color:#00ff99; }
.red{ color:#ff5252; }
.blue{ color:#00bcd4; }
</style>
</head>

<body>

<!-- ===== HEADER WITH BACK ===== -->
<div class="topbar">
  <div class="back-btn" onclick="goBack()">â¬… Back</div>
  <h2>ðŸ“Š Stats Dashboard</h2>
</div>

  <!-- ===== FII / DII ===== -->
<div class="grid">
  <div class="card">
    <div class="label">Today Net</div>
    <div class="value" id="netToday">0</div>
    <div class="label">FII: <span id="fiiToday"></span> | DII: <span id="diiToday"></span></div>
  </div>

  <div class="card">
    <div class="label">Prev Day Net</div>
    <div class="value" id="netPrev">0</div>
    <div class="label">FII: <span id="fiiPrev"></span> | DII: <span id="diiPrev"></span></div>
  </div>

  <div class="card">
    <div class="label">MTD Net</div>
    <div class="value" id="netMTD">0</div>
    <div class="label">FII: <span id="fiiMTD"></span> | DII: <span id="diiMTD"></span></div>
  </div>

  <div class="card">
    <div class="label">Prev Month Net</div>
    <div class="value" id="netPM">0</div>
    <div class="label">FII: <span id="fiiPM"></span> | DII: <span id="diiPM"></span></div>
  </div>
</div>

<div class="grid">
  <div class="card"><div class="label">Total Trades</div><div class="value" id="totalTrades">0</div></div>
  <div class="card"><div class="label">Win Rate (%)</div><div class="value blue" id="winRate">0</div></div>

  <div class="card"><div class="label">Total Profit (â‚¹)</div><div class="value green" id="totalProfit">0</div></div>
  <div class="card"><div class="label">Total Loss (â‚¹)</div><div class="value red" id="totalLoss">0</div></div>

  <div class="card"><div class="label">Net P&amp;L (â‚¹)</div><div class="value" id="netPnL">0</div></div>
  <div class="card"><div class="label">BTST Win %</div><div class="value blue" id="btstWinRate">0</div></div>

  <div class="card"><div class="label">Avg Profit</div><div class="value green" id="avgProfit">0</div></div>
  <div class="card"><div class="label">Avg Loss</div><div class="value red" id="avgLoss">0</div></div>

  <div class="card" style="grid-column:1/3">
    <div class="label">Demand Close Success %</div>
    <div class="value blue" id="demandCloseSuccess">0</div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxaLJdfOHI2rmDGhI_WdjyWkHrAlycOCepsgORmNnbDXnWzNxtasdGZW3yxftKvWhq8Iw/exec";

/* BACK */
function goBack(){
  window.location.href = "index.html";
}

/* LOAD STATS */
fetch(API_URL + "?action=stats&t=" + Date.now())
  .then(r => r.json())
  .then(s => {
    totalTrades.innerText        = s["Total Trades"] ?? 0;
    totalProfit.innerText        = s["Total Profit"] ?? 0;
    totalLoss.innerText          = s["Total Loss"] ?? 0;
    netPnL.innerText             = s["Net P&L"] ?? 0;
    winRate.innerText            = s["Win Rate"] ?? "0%";
    avgProfit.innerText          = s["Avg Profit"] ?? 0;
    avgLoss.innerText            = s["Avg Loss"] ?? 0;
    btstWinRate.innerText        = s["BTST Win %"] ?? "0%";
    demandCloseSuccess.innerText = s["Demand close success"] ?? "0%";
  });

  function paint(el, v){
  el.classList.remove("green","red","blue");
  if (Number(v) > 0) el.classList.add("green");
  else if (Number(v) < 0) el.classList.add("red");
  else el.classList.add("blue");
}

fetch(API + "?action=fiidii&t=" + Date.now())
  .then(r=>r.json())
  .then(d=>{
    fiiToday.textContent = d["FII_Today"];
    diiToday.textContent = d["DII_Today"];
    netToday.textContent = d["Net_Today"]; paint(netToday, d["Net_Today"]);

    fiiPrev.textContent = d["FII_Prev"];
    diiPrev.textContent = d["DII_Prev"];
    netPrev.textContent = d["Net_Prev"]; paint(netPrev, d["Net_Prev"]);

    fiiMTD.textContent = d["FII_MTD"];
    diiMTD.textContent = d["DII_MTD"];
    netMTD.textContent = d["Net_MTD"]; paint(netMTD, d["Net_MTD"]);

    fiiPM.textContent = d["FII_PrevMonth"];
    diiPM.textContent = d["DII_PrevMonth"];
    netPM.textContent = d["Net_PrevMonth"]; paint(netPM, d["Net_PrevMonth"]);
  });
</script>

</body>
</html>
